<!DOCTYPE html>
<html>
  <head>
    <title>Hospital Rooms</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles-dark.css" />

    <!-- Bootstrap JavaScript -->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
      integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
      integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
      crossorigin="anonymous"
    ></script>

    <style>
      button {
        width: 50px;
        height: 50px;
        margin: 10px;
        font-size: 20px;
        font-weight: bold;
        border-radius: 10px;
        border: none;
        color: white;
      }
      form button {
        width: 200px;
      }

      .occupied {
        background-color: gray;
      }

      .vacant {
        background-color: greenyellow;
      }
    </style>
  </head>
  <body data-bs-theme="dark">
    <h1>Rooms</h1>

    <div id="room-buttons"></div>

    <div class="container">
      <div class="card">
        <div class="card-body">
          <form method="PUT">
            <h5>Room Information</h5>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="roomNumber" class="form-label">Room Number</label>
                <input
                  type="text"
                  class="form-control"
                  id="roomNumber"
                  name="roomNumber"
                  value=""
                  readonly
                  style="pointer-events: none; cursor: default"
                />
              </div>
              <div class="col-md-3">
                <label for="isOccupied" class="form-label">is Occupied</label>
                <select class="form-select" id="isOccupied" name="isOccupied">
                  <option value="true">true</option>
                  <option value="false">false</option>
                </select>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="name" class="form-label"></label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  name="name"
                  value=""
                />
              </div>
              <div class="col-md-3">
                <label for="age" class="form-label"></label>
                <input
                  type="number"
                  class="form-control"
                  id="age"
                  name="age"
                  value=""
                />
              </div>
              <div class="col-md-3">
                <label for="gender" class="form-label">Gender</label>
                <select class="form-select" id="gender" name="gender">
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="admissionDate" class="form-label"
                  >Admission Date</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="admissionDate"
                  name="admissionDate"
                  value=""
                />
              </div>
              <div class="col-md-6">
                <label for="vacatingnDate" class="form-label"
                  >Vacating Date</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="vacatingDate"
                  name="vacatingDate"
                  value=""
                />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="roomType" class="form-label">Room Type</label>
                <input
                  type="text"
                  class="form-control"
                  id="roomType"
                  name="roomType"
                  value=""
                />
              </div>
              <div class="col-md-3">
                <label for="costPerDay" class="form-label">Cost Per Day</label>
                <input
                  type="number"
                  class="form-control"
                  id="costPerDay"
                  name="costPerDay"
                  value=""
                />
              </div>
              <div class="col-md-3">
                <label for="maxOccupancy" class="form-label"
                  >Max Occupancy</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="maxOccupancy"
                  name="maxOccupancy"
                  value="1"
                />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="amenities" class="form-label">Amenities</label>
                <input
                  type="text"
                  class="form-control"
                  id="amenities"
                  name="amenities"
                  value=""
                />
              </div>
              <div class="col-md-6">
                <label for="notes" class="form-label">Notes</label>
                <textarea
                  class="form-control"
                  id="notes"
                  name="notes"
                  rows="3"
                ></textarea>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Save</button>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Get the room buttons container
      const roomButtons = document.getElementById("room-buttons");

      // Fetch the room data from the JSON file and store it in a variable
      fetch("rooms.json")
        .then((response) => response.json())
        .then((data) => {
          const rooms = data.rooms;

          // Loop through the rooms and create a button for each one
          rooms.forEach((room) => {
            const button = document.createElement("button");
            button.textContent = room.roomNumber;
            button.id = room.roomNumber;
            button.classList.add("room-button");
            button.classList.add(room.isOccupied ? "occupied" : "vacant");
            roomButtons.appendChild(button);
          });
        })
        .catch((error) => console.error(error));

      // Get the form element
      const form = document.querySelector("form");

      // Add a click event listener to the room buttons container
      roomButtons.addEventListener("click", (event) => {
        // Get the room number from the ID of the clicked button
        const roomNumber = event.target.id;

        // Fetch the room data from the JSON file and store it in a variable
        fetch("rooms.json")
          .then((response) => response.json())
          .then((data) => {
            const rooms = data.rooms;

            // Find the room with the matching room number
            const room = rooms.find((room) => room.roomNumber === roomNumber);

            // Update the form with the data from the room object
            document.getElementById("roomNumber").value = room.roomNumber;
            document.getElementById("roomType").value = room.roomType;
            document.getElementById("costPerDay").value = room.costPerDay;
            document.getElementById("maxOccupancy").value = room.maxOccupancy;
            document.getElementById("amenities").value = room.amenities;

            if (room.patient.admissionDate == null) {
              document.getElementById("name").value = "";
              document.getElementById("age").value = "";
              document.getElementById("gender").value = "";
              document.getElementById("admissionDate").value = "";
              document.getElementById("vacatingDate").value = "";
              document.getElementById("notes").value = "";
              document.getElementById("isOccupied").value = room.isOccupied;
            } else {
              document.getElementById("name").value = room.patient.name;
              document.getElementById("age").value = room.patient.age;
              document.getElementById("gender").value = room.patient.gender;
              document.getElementById("admissionDate").value =
                room.patient.admissionDate;
              document.getElementById("vacatingDate").value =
                room.patient.vacatingDate;
              document.getElementById("notes").value = room.notes;
              document.getElementById("isOccupied").value = room.isOccupied;
            }
          })
          .catch((error) => console.error(error));
      });

      //update
      const saveButton = document.querySelector('button[type="submit"]');

        saveButton.addEventListener("click", function (event) {
        
        event.preventDefault(); // prevent form submission
        
        const roomNumber = document.getElementById("roomNumber").value;
        const roomType = document.getElementById("roomType").value;
        const costPerDay = document.getElementById("costPerDay").value;
        const maxOccupancy = document.getElementById("maxOccupancy").value;
        const isOccupied = document.getElementById("isOccupied").value;
        const amenities = document.getElementById("amenities").value.split(",");
        const name = document.getElementById("name").value;
        const patientAge = document.getElementById("age").value;
        const patientGender = document.getElementById("gender").value;
        const admissionDate = document.getElementById("admissionDate").value;
        const vacatingDate = document.getElementById("vacatingDate").value;
        const notes = document.getElementById("notes").value;

        // Load the JSON file
        fetch("rooms.json")
          .then((response) => response.json())
          .then((data) => {
            // Find the room with the specified roomNumber
            const roomIndex = data.rooms.findIndex(
              (room) => room.roomNumber === roomNumber
            );

            if (roomIndex !== -1) {
              // Update the room details
              data.rooms[roomIndex].roomType = roomType;
              data.rooms[roomIndex].costPerDay = Number(costPerDay);
              data.rooms[roomIndex].maxOccupancy = Number(maxOccupancy);
              data.rooms[roomIndex].isOccupied = isOccupied;
              data.rooms[roomIndex].amenities = amenities;
              data.rooms[roomIndex].patient.name = name;
              data.rooms[roomIndex].patient.age = Number(patientAge);
              data.rooms[roomIndex].patient.gender = patientGender;
              data.rooms[roomIndex].patient.admissionDate = admissionDate;
              data.rooms[roomIndex].patient.vacatingDate = vacatingDate;
              data.rooms[roomIndex].notes = notes;

              // Save the updated JSON file
              fetch("rooms.json", {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              })
                .then(() => {
                  console.log("Room details updated successfully!");
                })
                .catch((error) => {
                  console.error("Error updating room details:", error);
                });
            } else {
              console.error(`Room with number ${roomNumber} not found.`);
            }
          })
          .catch((error) => {
            console.error("Error loading room details:", error);
          });
      });
    </script>
  </body>
</html>
